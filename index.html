<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title id='title'>Toy Building App</title>

		<!--CSS-->
		<link rel="stylesheet" type="text/css" href="styles.css" />

		<!--Javascript-->
		<!--Core-->
		<script type="text/javascript" src="components/module.js" ></script>
		<script type="text/javascript" src="components/manager.js" ></script>
		<script type="text/javascript" src="components/sprite.js" ></script>
		<script type="text/javascript" src="components/characterSkeleton.js" ></script>
		<script type="text/javascript" src="components/currentState.js" ></script>
		<script type="text/javascript" src="components/splashScreen.js" ></script>
		<script type="text/javascript" src="components/scenarioScreen.js" ></script>
		<script type="text/javascript" src="components/Screen.js" ></script>
		<script type="text/javascript" src="components/textbox.js"></script>
		<script type="text/javascript" src="components/domElement.js"></script>
		<script type="text/javascript" src="components/grid.js"></script>
		<script type="text/javascript" src="components/state.js"></script>
		<script type="text/javascript" src="components/stateManager.js"></script>



		<!--Our modules and states-->
		<script type="text/javascript" src="components/superhero/playArea.js" ></script>
		<script type="text/javascript" src="components/superhero/toybox.js" ></script>
		<script type="text/javascript" src="components/superhero/toyboxTab.js" ></script>
		<script type="text/javascript" src="components/superhero/scenarioScreen.js" ></script>
		<script type="text/javascript" src="components/superhero/splashScreen.js" ></script>
		<script type="text/javascript" src="components/superhero/detailedScenarioScreen.js"></script>
		<script type="text/javascript" src="components/superhero/qualitiesScreen.js"></script>
		<script type="text/javascript" src="components/superhero/characterBuilder.js"></script>
		<script type="text/javascript" src="components/superhero/powersScreen.js"></script>
		<script type="text/javascript" src="components/superhero/characterBioScreen.js"></script>

		<!--Extensions-->
		<script type="text/javascript" src="extensions/touch.js" ></script>
		<script type="text/javascript" src="extensions/jsonLoader.js"></script>

		<script>

			var canvas, ctx, manager, playArea;
			var bioSubmission;
			var superhero = {
				"virtues":[],
				"skeleton":undefined,
				"powers":[]
			}


			function onLoad(){


				//Grab the Canvas.

				bioSubmission = DomWrapper(document.getElementById("bioSubmitBox"));
				canvas = document.getElementById("main");
				ctx = canvas.getContext("2d");
				//Make the canvas full screen

				//Size the canvas as far as we can.
				var wantedHeightProp = window.innerHeight / 1080;
				var wantedWidthProp = window.innerWidth / 1920;
				var scale = (wantedHeightProp < wantedWidthProp)? wantedHeightProp : wantedWidthProp;

				canvas.style.height = 1080 * scale;
				canvas.style.width = 1920 * scale;

				//create and add elements
				manager = Manager(canvas, ctx, 1/scale);
				

				manager.setLoad(function(){
					manager.draw();
				});
				
				
				//currentState = CurrentState(0, 0, 1920, 1080);
				currentState = StateManager(SplashScreen({"superhero":superhero}));
				manager.addModule(currentState);

			}



			function loadErrorScreen(){
				sc = new SplashScreen();
				currentState.addModule(sc);
				//Splash Image
				splashImage = Sprite(0,0,1920,1080, "images/dev/error.png");
				sc.addModule(splashImage);
				
				//Buttons
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				//Events
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			
			function loadResultsScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(0,0,1920,1080, "images/dev/resultsScreenTest01.png");
				sc.addModule(splashImage);
				
				//Logic
				//See if based on qualities and powers if the player won or lost the scenario
				powerFound = false;
				qualityFound = false;
				for(i = 0; i < superhero.powers.length; i++) {
					if(superhero.powers[i] == "saveKitten"){
						//If the logic finds its way here, then it means that the power is already in the list.
						//So now we have to remove it
						powerFound = true;
					}
				}
				for(i = 0; i < superhero.virtues.length; i++) {
					if(superhero.virtues[i] == "beingAwesome"){
						//If the logic finds its way here, then it means that the power is already in the list.
						//So now we have to remove it
						qualityFound = true;
					}
				}
				if(qualityFound && powerFound){
					resultImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,256,256, "images/dev/win.png");
				}else{
					resultImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,256,256, "images/dev/lose.png");
				}
				sc.addModule(resultImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("characterBioScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("whyItWorkedScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function loadWhyItWorkedScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,128,128, "images/dev/whyItWorkedScreen.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("resultsScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("superPoseScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function loadSuperPoseScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(0,0,1920,1080, "images/dev/superPoseScreenTest01.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("whyItWorkedScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}

			function switchState(_state){
				//Remove current state data
				manager.removeModule(currentState);
				currentState = CurrentState(0, 0, 1920, 1080);
				manager.addModule(currentState);
				
				//set current state = _state
				if(_state == "splashScreen"){loadSplashScreen();
				}else if(_state == "scenarioScreen"){loadScenarioScreen();
				}else if(_state == "detailedScenarioScreen"){loadDetailedScenarioScreen();
				}else if(_state == "qualitiesScreen"){loadQualitiesScreen();
				}else if(_state == "characterBuilder"){
					//The two main areas of our app inside of the canvas.
					createPlayArea();
					createToyBox();
				}else if(_state == "powersScreen"){loadPowersScreen();
				}else if(_state == "characterBioScreen"){loadCharacterBioScreen();
				}else if(_state == "resultsScreen"){loadResultsScreen();
				}else if(_state == "whyItWorkedScreen"){loadWhyItWorkedScreen();
				}else if(_state == "superPoseScreen"){loadSuperPoseScreen();
				}else{
					loadErrorScreen();
				}
			}
		window.onload = onLoad;
		</script>
	</head>



	<!--Main app-->
	<body>
		<!--Canvas is width and height of the screen.-->
		<!--We'll need to set this stuff up so it goes full screen I guess.-->
		
		<!--I don't really understand how the width and height is functioning 
		below on the canvas in line style. It seems to be acting as a resolution 
		for the canvas. Not sure if canvas properties itself, or 
		Possibly due to the fact that the canvas was made full screen 
		by the "onLoad" script at the top of this page.-->
		<textarea id="bioSubmitBox" style="visibility:hidden; position:absolute; left:10px; top:10px; width:400px; height:400px"></textarea> 
		<canvas id="main" width="1920px" height="1080px"></canvas>
	</body>

</html>