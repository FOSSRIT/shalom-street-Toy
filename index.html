<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title id='title'>Toy Building App</title>

		<!--CSS-->
		<link rel="stylesheet" type="text/css" href="styles.css" />

		<!--Javascript-->
		<script type="text/javascript" src="components/module.js" ></script>
		<script type="text/javascript" src="components/manager.js" ></script>
		<script type="text/javascript" src="components/sprite.js" ></script>
		<script type="text/javascript" src="components/characterSkeleton.js" ></script>
		<script type="text/javascript" src="components/playArea.js" ></script>
		<script type="text/javascript" src="components/toybox.js" ></script>
		<script type="text/javascript" src="components/toyboxTab.js" ></script>
		<script type="text/javascript" src="components/currentState.js" ></script>
		<script type="text/javascript" src="components/splashScreen.js" ></script>
		<script type="text/javascript" src="components/scenarioScreen.js" ></script>
		<script type="text/javascript" src="components/Screen.js" ></script>
		<script type="text/javascript" src="components/textbox.js"></script>
		<script type="text/javascript" src="components/domElement.js"></script>
		<!--Extensions-->
		<script type="text/javascript" src="extensions/touch.js" ></script>
		<script type="text/javascript" src="extensions/jsonLoader.js"></script>

		<script>

			var canvas, ctx, manager, playArea;
			var superhero = {
				"powers":[],
				"skeleton":undefined,
				"virtues":[]
			}
			function onLoad(){


				//Grab the Canvas.
				canvas = document.getElementById("main");
				ctx = canvas.getContext("2d");
				//Make the canvas full screen

				var wantedHeightProp = window.innerHeight / 1080;
				var wantedWidthProp = window.innerWidth / 1920;
				var scale = (wantedHeightProp < wantedWidthProp)? wantedHeightProp : wantedWidthProp;

				canvas.style.height = 1080 * scale;
				canvas.style.width = 1920 * scale;

				//create and add elements
				manager = Manager();
				manager.init(canvas, ctx, 1/scale);
				

				manager.setLoad(function(){
					manager.draw();
				});
				
				
				currentState = CurrentState(0, 0, 1920, 1080);
				manager.addModule(currentState);
				/*
				var domElementThing = DomWrapper(document.getElementById("myDomObject"));
					
				domElementThing.visible = true;
				manager.addModule(domElementThing);
				*/
				
				//Load up the splash screen.
				switchState("splashScreen");
				
				
				
				
				// dev1.addEvent("mousedown", function(_clipBoard){
				// 	_clipBoard.ToFire = ["swapComponent"];
				// 	_clipBoard.Body = {"image":"images/dev/_01.png", "slot":"body"}
				// }, false);

				
				//\toy.addEvent("mouseup", function(_clipBoard){ alert("hi, I'm Esther!"); }, false);
			}
			function loadErrorScreen(){
				sc = new SplashScreen(0,0,1920, 1080);
				currentState.addModule(sc);
				//Splash Image
				splashImage = Sprite(0,0,1920,1080, "images/dev/error.png");
				sc.addModule(splashImage);
				
				//Buttons
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				//Events
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function loadSplashScreen(){
				sc = new SplashScreen(0,0,1920, 1080);
				currentState.addModule(sc);
				//Splash Image
				splashImage = Sprite(0,0,1920,1080, "images/dev/splashTest.png");
				sc.addModule(splashImage);
				
				//Buttons
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				//Events
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("scenarioScreen");
				},false);
			}
			function loadScenarioScreen(){
				sc = new ScenarioScreen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(0,0,1920,1080, "images/dev/scenarioScreen.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				scenario1Button = Sprite(sc.bounds.width/5, sc.bounds.height/3-128, 256, 256, "images/dev/scenarioButton.png");
				sc.addModule(scenario1Button);
				
				scenario2Button = Sprite(2*sc.bounds.width/5, sc.bounds.height/3-128, 256, 256, "images/dev/scenarioButton2.png");
				sc.addModule(scenario2Button);
				
				scenario3Button = Sprite(3*sc.bounds.width/5, sc.bounds.height/3-128, 256, 256, "images/dev/scenarioButton.png");
				sc.addModule(scenario3Button);
				
				scenario4Button = Sprite(sc.bounds.width/5, 2*sc.bounds.height/3-128, 256, 256, "images/dev/scenarioButton.png");
				sc.addModule(scenario4Button);
				
				scenario5Button = Sprite(2*sc.bounds.width/5, 2*sc.bounds.height/3-128, 256, 256, "images/dev/scenarioButton.png");
				sc.addModule(scenario5Button);
				
				randomScenarioButton = Sprite(3*sc.bounds.width/5, 2*sc.bounds.height/3-128, 256, 256, "images/dev/randomScenarioButton.png");
				sc.addModule(randomScenarioButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
				
				scenario1Button.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("detailedScenarioScreen");
				},false);
				
				scenario2Button.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("detailedScenarioScreen");
				},false);
				
				scenario3Button.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("detailedScenarioScreen");
				},false);
				
				scenario4Button.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("detailedScenarioScreen");
				},false);
				
				scenario5Button.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("detailedScenarioScreen");
				},false);
				
				randomScenarioButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("detailedScenarioScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function loadDetailedScenarioScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(sc.bounds.width/2-512,sc.bounds.height/2-256,1024,512, "images/dev/detailedScenarioScreen2.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("scenarioScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("qualitiesScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function loadQualitiesScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,128,128, "images/dev/qualitiesScreen.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("detailedScenarioScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("characterBuilder");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);


				//When you click on a button, you can add a quality like so.
				//superhero.virtues.push("quality");
				//And reference it and all that good stuff like an array.
			}
			function loadPowersScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,128,128, "images/dev/powersScreen.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("characterBuilder");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("characterBioScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);

				//When you click on a button, you can add a power like so.
				//superhero.powers.push("fire");
				//And reference it and all that good stuff like an array.
			}
			function loadCharacterBioScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,128,128, "images/dev/characterBioScreen.png");
				sc.addModule(splashImage);

				var bioSubmission = DomWrapper(document.getElementById("bioSubmitBox"));
				sc.addModule(bioSubmission);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("powersScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("resultsScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);

				//Assumably, you could also attach this to the superhero object.
			}
			function loadResultsScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(0,0,1920,1080, "images/dev/resultsScreen.png");
				sc.addModule(splashImage);
				
				//Logic
				//See if based on qualities and powers if the player won or lost the scenario
				powerFound = false;
				qualityFound = false;
				for(i = 0; i < superhero.powers.length; i++) {
					if(superhero.powers[i] == "saveKitten"){
						//If the logic finds its way here, then it means that the power is already in the list.
						//So now we have to remove it
						powerFound = true;
					}
				}
				for(i = 0; i < superhero.virtues.length; i++) {
					if(superhero.virtues[i] == "beingAwesome"){
						//If the logic finds its way here, then it means that the power is already in the list.
						//So now we have to remove it
						qualityFound = true;
					}
				}
				if(qualityFound && powerFound){
					resultImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,256,256, "images/dev/win.png");
				}else{
					resultImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,256,256, "images/dev/lose.png");
				}
				sc.addModule(resultImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("characterBioScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("whyItWorkedScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function loadWhyItWorkedScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,128,128, "images/dev/whyItWorkedScreen.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("resultsScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("superPoseScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function loadSuperPoseScreen(){
				sc = new Screen(0,0,1920, 1080);
				currentState.addModule(sc);
				
				//Dev Splash Image
				splashImage = Sprite(sc.bounds.width/2-128,sc.bounds.height/2-128,128,128, "images/dev/superPoseScreen.png");
				sc.addModule(splashImage);
				
				//Buttons
				backButton = Sprite(0, 1080-128, 128, 128, "images/dev/back.png");
				sc.addModule(backButton);
				
				continueButton = Sprite(1920-128, 1080-128, 128, 128, "images/dev/continue.png");
				sc.addModule(continueButton);
				
				quitButton = Sprite(0, 0, 128, 128, "images/dev/quit.png");
				sc.addModule(quitButton);
				
				//Events
				backButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("whyItWorkedScreen");
				},false);
				
				continueButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
				
				quitButton.addEvent("mousedown", function(_clipBoard){
					manager.removeModule(sc);
					switchState("splashScreen");
				},false);
			}
			function createTabs(){
				//TEMP DEV TABS
				//the tabs themselves
				var devTab1 = Sprite(0, 0, 128, 128, "images/dev/tab1.png");
				var devTab2 = Sprite(128, 0, 128, 128, "images/dev/tab2.png");
				var devTab3 = Sprite(256, 0, 128, 128, "images/dev/tab3.png");
			
				//Toybox tabs.
				//the components inside each tab
				var tab1 = ToyBoxTab(0, 128, toybox.bounds.width, toybox.bounds.height - 128, "head");
					//Components in side of a tab
					tab1.addOption(Sprite(0, 0, 128, 128, "images/Esther sets/Esther-1/esther-set-1-02.png"), "images/Esther sets/Esther-1/esther-set-1-02.png");
					tab1.addOption(Sprite(128, 0, 128, 128, "images/Esther sets/Esther-2/esther-set-2-02.png"), "images/Esther sets/Esther-2/esther-set-2-02.png");
					tab1.addOption(Sprite(0, 128, 128, 128, "images/Esther sets/Esther-3/esther-set-3-02.png"), "images/Esther sets/Esther-3/esther-set-3-02.png");
					tab1.addOption(Sprite(128, 128, 128, 128, "images/dev/_04.png"), Sprite(0, 0, 230, 230, "images/dev/_04.png"));
					//add the tab to the toybox
				var tab2 = ToyBoxTab(0, 128, toybox.bounds.width, toybox.bounds.height - 128, "body");
					tab2.addOption(Sprite(0, 0, 128, 128, "images/Esther sets/Esther-1/esther-set-1-03.png"), "images/Esther sets/Esther-1/esther-set-1-03.png");
					tab2.addOption(Sprite(128, 0, 128, 128, "images/Esther sets/Esther-2/esther-set-2-03.png"), "images/Esther sets/Esther-2/esther-set-2-03.png");
					tab2.addOption(Sprite(0, 128, 128, 128, "images/dev/_05.png"), "images/dev/_05.png");
					tab2.addOption(Sprite(128, 128, 128, 128, "images/dev/_06.png"), "images/dev/_06.png");
				var tab3 = ToyBoxTab(0, 128, toybox.bounds.width, toybox.bounds.height - 128, "feet");
					tab3.addOption(Sprite(0, 0, 128, 128, "images/Esther sets/Esther-1/esther-set-1-04.png"), "images/Esther sets/Esther-1/esther-set-1-04.png");
					tab3.addOption(Sprite(128, 0, 128, 128, "images/Esther sets/Esther-2/esther-set-2-04.png"), "images/Esther sets/Esther-2/esther-set-2-04.png");
					tab3.addOption(Sprite(0, 128, 128, 128, "images/dev/_07.png"), "images/dev/_07.png");
					tab3.addOption(Sprite(128, 128, 128, 128, "images/dev/_08.png"), "images/dev/_08.png");
					
					//specific to toybox -- TEMP DEV
					//add all the things we just created to the toybox module
					toybox.addModule(devTab1);
					toybox.addModule(devTab2);
					toybox.addModule(devTab3);
					toybox.addModule(tab1);
					toybox.addModule(tab2);
					toybox.addModule(tab3);
					
					
				//DEV adding events
				devTab1.addEvent("mousedown", function(_clipBoard){ 
					console.log('selected dev tab 1');
					tab1.select();
					tab2.deselect();
					tab3.deselect();
					//ToDo: This next line isn't working.
					if(_clipBoard.ToFire) { _clipBoard.ToFire.push("redraw"); } else { _clipBoard.ToFire = ["redraw"]; }
					//work.
					//manager.draw();
				}, false);
				devTab2.addEvent("mousedown", function(_clipBoard){ 
					if(_clipBoard.ToFire) { _clipBoard.ToFire.push("redraw"); } else { _clipBoard.ToFire = ["redraw"]; }
					tab1.deselect();
					tab2.select();
					tab3.deselect();
					//manager.draw();
				}, false);
				devTab3.addEvent("mousedown", function(_clipBoard){ 
					if(_clipBoard.ToFire) { _clipBoard.ToFire.push("redraw"); } else { _clipBoard.ToFire = ["redraw"]; }
					tab1.deselect();
					tab2.deselect();
					tab3.select();
				}, false);
			}
			function createPlayArea(){
				playArea = PlayArea(0,0,2*1920/3,1080);
				currentState.addModule(playArea);
				
				//TEMP DEV TOY TEST
					// ADD MODULES
					//Here we do our test for stuff.
					if(superhero.skeleton === undefined){
						var toy = CharacterSkeleton(200, 150, 234, 400);
						//TEMP DEV SPRITE SET UP FOR TOY
						toy.setSlot("head", Sprite());
						toy.setSlot("body", Sprite());
						toy.setSlot("feet", Sprite());
						//Add events
						toy.addEvent("swapComponent", function(_clipBoard){ 
							console.log('swapping');
							toy.setSlot(_clipBoard.ComponentSwap.slot, 
							_clipBoard.ComponentSwap.image); 
							if(_clipBoard.ToFire) { _clipBoard.ToFire.push("redraw"); } else { _clipBoard.ToFire = ["redraw"]; }
						}, false);

						//And save for later.
						superhero.skeleton = toy;
					} else {
						var toy = superhero.skeleton;
					}
					//add the character skeleton to the scene.
					playArea.addModule(toy);
					
					//Buttons
					backButton = Sprite(playArea.bounds.x, playArea.bounds.height-128, 128, 128, "images/dev/back.png");
					playArea.addModule(backButton);
					
					continueButton = Sprite(playArea.bounds.width-128, playArea.bounds.height-128, 128, 128, "images/dev/continue.png");
					playArea.addModule(continueButton);
					
					quitButton = Sprite(playArea.bounds.x, playArea.bounds.y, 128, 128, "images/dev/quit.png");
					playArea.addModule(quitButton);
					
					//Events
					backButton.addEvent("mousedown", function(_clipBoard){
						manager.removeModule(playArea);
						switchState("qualitiesScreen");
					},false);
					
					continueButton.addEvent("mousedown", function(_clipBoard){
						manager.removeModule(playArea);
						switchState("powersScreen");
					},false);
					
					quitButton.addEvent("mousedown", function(_clipBoard){
						manager.removeModule(playArea);
						switchState("splashScreen");
					},false);
			}
			function createToyBox(){
				toybox = ToyBox(2*1920/3,0,1920/3,1080);
				currentState.addModule(toybox);
				createTabs();
				
			}
			function switchState(_state){
				//Remove current state data
				manager.removeModule(currentState);
				currentState = CurrentState(0, 0, 1920, 1080);
				manager.addModule(currentState);
				
				//set current state = _state
				if(_state == "splashScreen"){loadSplashScreen();
				}else if(_state == "scenarioScreen"){loadScenarioScreen();
				}else if(_state == "detailedScenarioScreen"){loadDetailedScenarioScreen();
				}else if(_state == "qualitiesScreen"){loadQualitiesScreen();
				}else if(_state == "characterBuilder"){
					//The two main areas of our app inside of the canvas.
					createPlayArea();
					createToyBox();
				}else if(_state == "powersScreen"){loadPowersScreen();
				}else if(_state == "characterBioScreen"){loadCharacterBioScreen();
				}else if(_state == "resultsScreen"){loadResultsScreen();
				}else if(_state == "whyItWorkedScreen"){loadWhyItWorkedScreen();
				}else if(_state == "superPoseScreen"){loadSuperPoseScreen();
				}else{
					loadErrorScreen();
				}
			}
		window.onload = onLoad;
		</script>
	</head>



	<!--Main app-->
	<body>
		<!--<div id="myDomObject">HELLO HELLO HELLO</div>-->
		<!--Canvas is width and height of the screen.-->
		<!--We'll need to set this stuff up so it goes full screen I guess.-->
		
		<!--I don't really understand how the width and height is functioning 
		below on the canvas in line style. It seems to be acting as a resolution 
		for the canvas. Not sure if canvas properties itself, or 
		Possibly due to the fact that the canvas was made full screen 
		by the "onLoad" script at the top of this page.-->
		<textarea id="bioSubmitBox" style="visibility:hidden; position:absolute; left:1000px; right:1000px" columns="25" rows="7"></textarea> 
		<canvas id="main" width="1920px" height="1080px"></canvas>
	</body>

</html>